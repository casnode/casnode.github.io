"use strict";(self.webpackChunkcasnode_website=self.webpackChunkcasnode_website||[]).push([[334],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),d=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return r.createElement(u.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,u=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(n),m=a,g=p["".concat(u,".").concat(m)]||p[m]||l[m]||s;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=p;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var d=2;d<s;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},958:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return l},frontMatter:function(){return s},metadata:function(){return i},toc:function(){return d}});var r=n(3117),a=(n(7294),n(3905));const s={title:"Migration depuis DiscuzX"},o=void 0,i={unversionedId:"migration",id:"migration",title:"Migration depuis DiscuzX",description:"Casnode a fourni un grand nombre de scripts Go pour aider les utilisateurs \xe0 migrer leurs forums de DiscuzX 3.x vers Casnode. Les scripts se trouvent \xe0 l'adresse//github.com/casbin/casnode/tree/master/discuzx",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/migration.md",sourceDirName:".",slug:"/migration",permalink:"/fr/docs/migration",draft:!1,editUrl:"https://github.com/casnode/casnode-website/tree/master/docs/migration.md",tags:[],version:"current",frontMatter:{title:"Migration depuis DiscuzX"},sidebar:"tutorialSidebar",previous:{title:"docker",permalink:"/fr/docs/docker"},next:{title:"Aper\xe7u de l'API",permalink:"/fr/docs/api-overview"}},u={},d=[{value:"Pr\xe9paration",id:"pr\xe9paration",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Migration",id:"migration",level:2}],c={toc:d};function l(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Casnode a fourni un grand nombre de scripts Go pour aider les utilisateurs \xe0 migrer leurs forums de DiscuzX 3.x vers Casnode. Les scripts se trouvent \xe0 l'adresse : ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/tree/master/discuzx"},"https://github.com/casbin/casnode/tree/master/discuzx")),(0,a.kt)("p",null,"Une base de donn\xe9es prise en charge par Xorm (par exemple, MySQL) est utilis\xe9e par Cansode pour stocker des donn\xe9es de forum comme des sujets et des r\xe9ponses. Le stockage d'objets (comme la forme du fournisseur de stockage Casdoor) est utilis\xe9 par Casnode pour stocker des images et des fichiers joints."),(0,a.kt)("h2",{id:"pr\xe9paration"},"Pr\xe9paration"),(0,a.kt)("p",null,"Vous devez pr\xe9parer les environnements suivants avant d'effectuer la migration :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Une VM nuageuse (mieux avec plus de 4 c\u0153urs et 8 Go de m\xe9moire, 8 c\u0153urs et 16 Go est encore mieux), mieux avec la connexion Intranet avec la base de donn\xe9es pour une vitesse plus \xe9lev\xe9e. Cette machine virtuelle est utilis\xe9e pour ex\xe9cuter les scripts de migration Go."),(0,a.kt)("li",{parentName:"ol"},"Un d\xe9p\xf4t git de Casnode avec les scripts de migration Go dans la machine virtuelle ci-dessus (la instance de Casnode peut \xeatre ex\xe9cut\xe9e ou arr\xeat\xe9e)."),(0,a.kt)("li",{parentName:"ol"},"Une instance Casdoor en cours d'ex\xe9cution (meilleure dans la m\xeame VM nuageuse pour une vitesse plus \xe9lev\xe9e), avec au moins un stockage d'objet est configur\xe9 en tant que fournisseur de stockage Casdoor . Ceci est utilis\xe9 pour t\xe9l\xe9charger les images et fichiers attach\xe9s de DiscuzX sur le stockage d'objet."),(0,a.kt)("li",{parentName:"ol"},"Votre instance DiscuzX est en ligne.")),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Tout d'abord, configurez correctement Casdoor et Casnode en fonction de leurs guides d'installation, assurez-vous qu'ils fonctionnent normalement avant la migration."),(0,a.kt)("admonition",{title:"Laissez Casdoor et Casnode se connecter \xe0 l'URL Intranet de la BD. Laissez le point de terminaison du fournisseur de stockage de Casdoor \xeatre l'URL Intranet du stockage d'objets nuageux. Ce sera beaucoup plus rapide. :::",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Configurez la base de donn\xe9es Casdoor dans le fichier app.conf de Casnode, pour que Casnode puisse se connecter directement \xe0 la base de donn\xe9es de Casdoor et cr\xe9er des utilisateurs. Cela sera plus rapide que d'appeler l'API RESTful de Casdoor pour cr\xe9er des utilisateurs."),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"format@@0 casdoorDbName = casdoor\n")),(0,a.kt)("p",{parentName:"admonition"},"Configurer le script de migration \xe0: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/conf.go"},"https://github.com/casbin/casnode/blob/master/discuzx/conf.go")," ."),(0,a.kt)("ol",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ol"},"dbName: le nom de votre DB de DiscuzX"),(0,a.kt)("li",{parentName:"ol"},"discuzxDomain: le domaine public de votre DiscuzX, avec slash final"),(0,a.kt)("li",{parentName:"ol"},"discuzxAttachmentBaseUrl : l'URL de base de votre pi\xe8ce jointe DiscuzX, avec une barre oblique finale (vous pouvez la r\xe9cup\xe9rer \xe0 partir d'une URL de fichier attach\xe9 de votre DiscuzX)"),(0,a.kt)("li",{parentName:"ol"},"avatarPoolBaseUrl: ne pas changer ceci")),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package discuzx\n\nvar dbName = "ultrax"\nvar discuzxDomain = "https://www.discuz.net/"\nvar discuzxAttachmentBaseUrl = "https://attachment.discuz.net/forum/"\n'))),(0,a.kt)("h2",{id:"migration"},"Migration"),(0,a.kt)("p",null,"Vous pouvez voir que le ",(0,a.kt)("inlineCode",{parentName:"p"},"XXXConcurrency")," est d\xe9fini en haut des scripts, c'est le nombre de threads simultan\xe9s pour effectuer la migration. Vous pouvez ajuster cette valeur en fonction de votre environnement. Si elle est trop petite, la migration sera tr\xe8s lente. Si elle est trop \xe9lev\xe9e, les connexions de la base de donn\xe9es seront plus susceptibles de rapporter des erreurs \xab Connexions trop nombreuses \xbb."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"var SyncAvatarsConcurrency = 20\n")),(0,a.kt)("admonition",{title:"Le temps d'estimation que nous fournissons dans les sections suivantes est mesur\xe9 dans une machine avec une connexion Internet \xe0 distance avec la base de donn\xe9es et le stockage d'objets. Si votre machine virtuelle est dans le m\xeame sous-r\xe9seau avec la base de donn\xe9es et le stockage d'objets, vous serez beaucoup plus rapide. :::",type:"tip"},(0,a.kt)("h3",{parentName:"admonition",id:"1-migration-des-utilisateurs"},"1. Migration des utilisateurs"),(0,a.kt)("p",{parentName:"admonition"},"Pour migrer tous les membres d'UCenter de DiscuzX vers les utilisateurs de Casdoor :"),(0,a.kt)("p",{parentName:"admonition"},"Ex\xe9cutez ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddUsers")," dans: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/user_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/user_test.go")),(0,a.kt)("p",{parentName:"admonition"},"Cette \xe9tape prendra environ 2 minutes pour 60 000 utilisateurs."),(0,a.kt)("h3",{parentName:"admonition",id:"2-migration-des-avatars-de-lutilisateur"},"2. Migration des avatars de l'utilisateur"),(0,a.kt)("p",{parentName:"admonition"},"Pour migrer tous les avatars des membres d'UCenter de DiscuzX vers les ressources de Casdoor (via le fournisseur de stockage de Casdoor, soutenu par le stockage d'objets cloud):"),(0,a.kt)("p",{parentName:"admonition"},"Ex\xe9cutez ",(0,a.kt)("inlineCode",{parentName:"p"},"TestSyncAvatars")," dans: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/avatar_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/avatar_test.go")),(0,a.kt)("p",{parentName:"admonition"},"Cette \xe9tape prendra environ 10 minutes pour 60 000 utilisateurs."),(0,a.kt)("h3",{parentName:"admonition",id:"3-migration-du-forum"},"3. Migration du forum"),(0,a.kt)("p",{parentName:"admonition"},"Pour migrer tous vos forums DiscuzX vers les onglets et n\u0153uds de Casdoor :"),(0,a.kt)("p",{parentName:"admonition"},"Ex\xe9cutez ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddForums")," dans: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/forum_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/forum_test.go")),(0,a.kt)("p",{parentName:"admonition"},"Cette \xe9tape se termine g\xe9n\xe9ralement en 2 secondes."),(0,a.kt)("h3",{parentName:"admonition",id:"4-migration-de-fils-et-de-messages"},"4. Migration de fils et de messages"),(0,a.kt)("p",{parentName:"admonition"},"Pour migrer tous vos fils de discussion & messages DiscuzX vers les sujets de Casdoor & r\xe9ponses:"),(0,a.kt)("p",{parentName:"admonition"},"Ex\xe9cutez ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddThreads")," dans: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/thread_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/thread_test.go")),(0,a.kt)("p",{parentName:"admonition"},"Cette \xe9tape prendra environ 7 minutes pour 10 000 utilisateurs."),(0,a.kt)("h2",{parentName:"admonition",id:"finalisation"},"Finalisation"),(0,a.kt)("p",{parentName:"admonition"},"Pendant la migration, vous pouvez garder l'instance Casnode en m\xeame temps pour que vous puissiez voir l'effet imm\xe9diatement en appuyant sur ",(0,a.kt)("inlineCode",{parentName:"p"},"F5")," dans la page d'accueil publique de Casnode."),(0,a.kt)("p",{parentName:"admonition"},"Si vous rencontrez une panique lors de l'ex\xe9cution des scripts de migration, contactez les auteurs de Casnode.")))}l.isMDXComponent=!0}}]);