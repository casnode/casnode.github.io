"use strict";(self.webpackChunkcasnode_website=self.webpackChunkcasnode_website||[]).push([[334],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=a,g=p["".concat(u,".").concat(m)]||p[m]||d[m]||i;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},958:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return l}});var r=n(3117),a=(n(7294),n(3905));const i={title:"Migration depuis DiscuzX",description:"Migration from DiscuzX",keywords:["discuz","discuz!","discuzx"]},o=void 0,s={unversionedId:"migration",id:"migration",title:"Migration depuis DiscuzX",description:"Migration from DiscuzX",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/migration.md",sourceDirName:".",slug:"/migration",permalink:"/fr/docs/migration",draft:!1,editUrl:"https://crowdin.com/project/casnode-website/fr",tags:[],version:"current",frontMatter:{title:"Migration depuis DiscuzX",description:"Migration from DiscuzX",keywords:["discuz","discuz!","discuzx"]},sidebar:"tutorialSidebar",previous:{title:"docker",permalink:"/fr/docs/docker"},next:{title:"Aper\xe7u de l'API",permalink:"/fr/docs/api-overview"}},u={},l=[{value:"Pr\xe9paration",id:"pr\xe9paration",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Migration",id:"migration",level:2},{value:"1. Migration des utilisateurs",id:"1-migration-des-utilisateurs",level:3},{value:"2. Migration des avatars de l&#39;utilisateur",id:"2-migration-des-avatars-de-lutilisateur",level:3},{value:"3. Migration du forum",id:"3-migration-du-forum",level:3},{value:"4. Migration de fils et de messages",id:"4-migration-de-fils-et-de-messages",level:3},{value:"Finalisation",id:"finalisation",level:2}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Casnode a fourni un grand nombre de scripts Go pour aider les utilisateurs \xe0 migrer leurs forums de DiscuzX 3.x vers Casnode. Les scripts se trouvent \xe0 l'adresse : ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/tree/master/discuzx"},"https://github.com/casbin/casnode/tree/master/discuzx")),(0,a.kt)("p",null,"Une base de donn\xe9es prise en charge par Xorm (par exemple, MySQL) est utilis\xe9e par Cansode pour stocker des donn\xe9es de forum comme des sujets et des r\xe9ponses. Le stockage d'objets (comme la forme du fournisseur de stockage Casdoor) est utilis\xe9 par Casnode pour stocker des images et des fichiers joints."),(0,a.kt)("h2",{id:"pr\xe9paration"},"Pr\xe9paration"),(0,a.kt)("p",null,"Vous devez pr\xe9parer les environnements suivants avant d'effectuer la migration :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Une VM nuageuse (mieux avec plus de 4 c\u0153urs et 8 Go de m\xe9moire, 8 c\u0153urs et 16 Go est encore mieux), mieux avec la connexion Intranet avec la base de donn\xe9es pour une vitesse plus \xe9lev\xe9e. Cette machine virtuelle est utilis\xe9e pour ex\xe9cuter les scripts de migration Go."),(0,a.kt)("li",{parentName:"ol"},"Un d\xe9p\xf4t git de Casnode avec les scripts de migration Go dans la machine virtuelle ci-dessus (la instance de Casnode peut \xeatre ex\xe9cut\xe9e ou arr\xeat\xe9e)."),(0,a.kt)("li",{parentName:"ol"},"Une instance Casdoor en cours d'ex\xe9cution (meilleure dans la m\xeame VM nuageuse pour une vitesse plus \xe9lev\xe9e), avec au moins un stockage d'objet est configur\xe9 en tant que fournisseur de stockage Casdoor . Ceci est utilis\xe9 pour t\xe9l\xe9charger les images et fichiers attach\xe9s de DiscuzX sur le stockage d'objet."),(0,a.kt)("li",{parentName:"ol"},"Votre instance DiscuzX est en ligne.")),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Tout d'abord, configurez correctement Casdoor et Casnode en fonction de leurs guides d'installation, assurez-vous qu'ils fonctionnent normalement avant la migration."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Let Casdoor and Casnode connect to the DB's Intranet URL. Let Casdoor's storage provider's endpoint be the Intranet URL of the cloud object storage. It will be much faster.")),(0,a.kt)("p",null,"Configure the Casdoor database in Casnode's app.conf, so Casnode can directly connect to Casdoor's DB and create users. This will be faster than calling Casdoor's RESTful API to create users."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"format@@0 casdoorDbName = casdoor\n")),(0,a.kt)("p",null,"Configure the migration script at: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/conf.go"},"https://github.com/casbin/casnode/blob/master/discuzx/conf.go")," ."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"dbName: le nom de votre DB de DiscuzX"),(0,a.kt)("li",{parentName:"ol"},"discuzxDomain: le domaine public de votre DiscuzX, avec slash final"),(0,a.kt)("li",{parentName:"ol"},"discuzxAttachmentBaseUrl : l'URL de base de votre pi\xe8ce jointe DiscuzX, avec une barre oblique finale (vous pouvez la r\xe9cup\xe9rer \xe0 partir d'une URL de fichier attach\xe9 de votre DiscuzX)"),(0,a.kt)("li",{parentName:"ol"},"avatarPoolBaseUrl: ne pas changer ceci")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package discuzx\n\nvar dbName = "ultrax"\nvar discuzxDomain = "https://www.discuz.net/"\nvar discuzxAttachmentBaseUrl = "https://attachment.discuz.net/forum/"\n')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"In Casnode, we assume you use the same DB username and password for all 3 DBs: Casnode's DB, Casdoor's DB and DiscuzX's DB. So make sure this DB user can access all 3 DBs.")),(0,a.kt)("h2",{id:"migration"},"Migration"),(0,a.kt)("p",null,"You may see the ",(0,a.kt)("inlineCode",{parentName:"p"},"XXXConcurrency"),' is defined at the top of the scripts, this is the number of the concurrent threads to do the migration. You can tune this value based on your environment. If it is too small, the migration will be very slow. If it is too high, the DB connections will be more likely to report "Connections too many" errors.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"var SyncAvatarsConcurrency = 20\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The estimation time we provide in the following sections is measured in a machine with remote Internet connection with the DB and object storage. If your VM is in the same subnet with the DB and object storage, you will be much faster.")),(0,a.kt)("h3",{id:"1-migration-des-utilisateurs"},"1. Migration des utilisateurs"),(0,a.kt)("p",null,"To migrate all your DiscuzX's UCenter members to Casdoor's users:"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddUsers")," in: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/user_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/user_test.go")),(0,a.kt)("p",null,"This step will roughly take 2 minutes for 60,000 users."),(0,a.kt)("h3",{id:"2-migration-des-avatars-de-lutilisateur"},"2. Migration des avatars de l'utilisateur"),(0,a.kt)("p",null,"To migrate all your DiscuzX's UCenter members' avatars to Casdoor's resources (via Casdoor's storage provider, backed by the cloud object storage):"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"TestSyncAvatars")," in: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/avatar_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/avatar_test.go")),(0,a.kt)("p",null,"This step will roughly take 10 minutes for 60,000 users."),(0,a.kt)("h3",{id:"3-migration-du-forum"},"3. Migration du forum"),(0,a.kt)("p",null,"To migrate all your DiscuzX's forums to Casdoor's tabs and nodes:"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddForums")," in: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/forum_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/forum_test.go")),(0,a.kt)("p",null,"This step will usually finish in 2 seconds."),(0,a.kt)("h3",{id:"4-migration-de-fils-et-de-messages"},"4. Migration de fils et de messages"),(0,a.kt)("p",null,"To migrate all your DiscuzX's threads & posts to Casdoor's topics & replies:"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"TestAddThreads")," in: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casbin/casnode/blob/master/discuzx/thread_test.go"},"https://github.com/casbin/casnode/blob/master/discuzx/thread_test.go")),(0,a.kt)("p",null,"This step will roughly take 7 minutes for 10,000 users."),(0,a.kt)("h2",{id:"finalisation"},"Finalisation"),(0,a.kt)("p",null,"During the migration, you can keep the Casnode instance running at the same time, so you can see the effect immediately by pressing ",(0,a.kt)("inlineCode",{parentName:"p"},"F5")," in Casnode's public homepage."),(0,a.kt)("p",null,"If you encounter panic when running the migration scripts, contact the Casnode authors."))}d.isMDXComponent=!0}}]);